{"version":3,"sources":["../src/FieldConverter.es6"],"names":["FormItem","Item","TextArea","FieldConverter","converters","converter","push","option","fieldForm","i","length","convert","obj","field","_render","props","DBTableInstance","colWrapper","internalConvert","wrapper","wrapperOption","getFieldProps","fieldOptions","isHidethis","primaryKey","key","form","getFieldDecorator","minRows","maxRows","fieldItem","extendConvert","rules","formItemsConfig","disabled","initialValue","valuePropName","formItem"],"mappings":"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","file":"FieldConverter.js","sourcesContent":["/**\n * Created by zxh on 2016/12/12.\n */\nimport React from 'react';\nimport {\n  Form,\n  Col,\n  Input,\n  Button,\n  DatePicker,\n  Select,\n  Table,\n  Icon,\n  Radio,\n  InputNumber,\n  Checkbox,\n  Modal,\n  message,\n  notification,\n  Affix,\n  Upload\n} from 'antd';\n\nconst FormItem = Form.Item;\n\nconst TextArea = Input.TextArea;\n\nclass FieldConverter {\n\n  constructor() {\n    this.converters = [];\n  }\n\n  addConverter(converter) {\n    this.converters.push(converter);\n  }\n\n  //调用.convert()真正返回的东西\n  extendConvert(option) {\n    var fieldForm = null;\n\n    for(var i=0;i<this.converters.length;i++)\n    {\n      fieldForm = this.converters[i].convert(option);\n      if (fieldForm != null) {\n        break;\n      }\n    }\n    return fieldForm;\n  }\n\n  convert(obj, field) {//InnerTale(this), formSchema [key]\n    if (typeof field._render === 'function') {\n      return field._render(obj, obj.props.DBTableInstance)\n    }\n    var colWrapper = this.colWrapper;\n    return this.internalConvert({ obj: obj, field: field, wrapper: colWrapper });\n  }\n\n  /**\n   * 将schema中的一个字段转换为表单的一项\n   *\n   * @param field\n   */\n  internalConvert(option) {//{obj: InnerTable(this), field: formSchema[key], wrapper: colWrapper}\n    this.wrapperOption(option);//添加常用属性引用别名\n    // options = {\n    //  obj: InnerTable(this)\n    //  field: formSchema[key]\n    //  wrapper: colWrapper\n    //  getFieldProps: InnerTable(this).getFieldProps  见../../DBTable/index ：401\n    //  fieldOptions: {\n    //    rules: field.rules,\n    //    initialValue: field.initialValue,\n    //    valuePropName: field.valuePropName\n    //  }\n    // }\n    const {getFieldProps, field, fieldOptions, wrapper, obj} = option;\n\n    if (field.isHidethis) {\n      return;\n    }\n\n    //obj.formData[field.key]\n    // 对于主键, 直接返回一个不可编辑的textarea\n    if (this.primaryKey === field.key) { //FIXME：this? 2017年9月18日11:39:18 Rival\n      return wrapper((\n        {...obj.props.form.getFieldDecorator(field.key)(<TextArea autosize={{ minRows: 1, maxRows: 10 }} disabled\n          size=\"default\"  />)}\n      ), field);\n    }\n\n    var fieldItem = this.extendConvert(option);\n\n    if (fieldItem != null)// FIXME: 有何意义? 2017年9月18日11:40:24 Rival\n      return fieldItem;\n  }\n\n  wrapperOption(option) {\n    option.getFieldProps = option.obj.props.form.getFieldProps;\n    var fieldOptions = {};\n\n    /**\n     * 修订原因：form表单要动态显示\n     * 修订时间：2017年10月18日11:20:25\n     * 修订人：Rival\n     */\n    if (option.field.rules) {\n      if (option.obj.props.formItemsConfig && option.obj.props.formItemsConfig[option.field.key] && option.obj.props.formItemsConfig[option.field.key].disabled) {\n        return fieldOptions.rules = [];\n      }\n      fieldOptions.rules = option.field.rules;\n    }\n\n    if (option.field.initialValue) {\n      fieldOptions.initialValue = option.field.initialValue;\n    }\n\n    if (option.field.valuePropName) {\n      fieldOptions.valuePropName = option.field.valuePropName;\n    }\n    option.fieldOptions = fieldOptions;\n  }\n\n  colWrapper(formItem, field)\n  {\n    return null;\n  }\n}\n\nexport default FieldConverter;\n"]}