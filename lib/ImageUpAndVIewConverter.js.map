{"version":3,"sources":["../src/ImageUpAndVIewConverter.es6"],"names":["FormItem","Item","logger","getLogger","ImageUpAndVIewConverter","option","getFieldProps","field","fieldOptions","wrapper","obj","dataType","transformImageFile","file","isJPG","type","isPNG","isGIF","isBMP","error","message","description","imageFileUpUrl","OPTION_IMAGE","OPTION_SAVE","OPTION_MD5","upOpt","state","len","length","queryUrl","i","url","responseStatus","bpButton","props","form","getFieldDecorator","key","fileList","onImageFileChange","onRemove","handlePreview","fileListSize","previewVisible","handleCancel","width","previewImage"],"mappings":"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","file":"ImageUpAndVIewConverter.js","sourcesContent":["/**\n * Created by zxh on 2016/12/12.\n */\nimport React from 'react';\nimport {\n  Form,\n  Col,\n  Input,\n  Button,\n  DatePicker,\n  Select,\n  Table,\n  Icon,\n  Radio,\n  InputNumber,\n  Checkbox,\n  Modal,\n  message,\n  notification,\n  Affix,\n  Upload\n} from 'antd';\n\nconst FormItem = Form.Item;\n\nimport Logger from 'ns_logger';\n\n\nconst logger = Logger.getLogger('ImageUpAndVIewConverter');\n\nclass ImageUpAndVIewConverter {\n\n  convert(option) {\n    const {getFieldProps, field, fieldOptions, wrapper, obj} = option;\n    switch (field.dataType) {\n      case 'imageFileUpAndView':\n        return this.transformImageFile(option);\n    }\n  }\n  beforeUpload(file) {\n    const isJPG = file.type === 'image/jpeg';\n    const isPNG = file.type === 'image/png';\n    const isGIF = file.type === 'image/gif';\n    const isBMP = file.type === 'image/bmp';\n    if (!isJPG && !isPNG && !isGIF && !isBMP ) {\n      notification.error({\n        message: '请上传正确的图片文件',\n        description: '系统支持jpg、png、gif、bmp，4种文件格式'});\n    }\n    return isJPG || isPNG || isGIF || isBMP;\n  }\n  /**\n   * 将schema中的一列转换为下拉框\n   *\n   * @param field\n   */\n  transformImageFile(option) {\n    const {getFieldProps, field, fieldOptions, obj, wrapper} = option;\n    const imageFileUpUrl = field.imageFileUpUrl;\n    const OPTION_IMAGE =0x1;\n    const OPTION_SAVE =0x1<<1;\n    const OPTION_MD5 =0x1<<2;\n    const upOpt = obj.state.upOpt\n    const len = upOpt ? upOpt.length : 0;\n    let queryUrl = 0;\n    for(let i=0; i < len; i++){\n      switch (upOpt[i]) {\n        case 'OPTION_SAVE':\n          queryUrl = OPTION_SAVE | queryUrl;\n          break;\n        case 'OPTION_MD5':\n          queryUrl = OPTION_MD5 | queryUrl;\n          break;\n      }\n    }\n    const url = `${imageFileUpUrl}?requestFlag=${queryUrl}&responseFlag=${obj.responseStatus}`\n    const bpButton = (<Button type=\"ghost\">\n      <div>\n        <Icon type=\"plus\" />\n        <div className=\"ant-upload-text\">点击上传</div>\n      </div>\n    </Button>)\n    // console.log('obj',obj)\n    return wrapper((\n      {...obj.props.form.getFieldDecorator(field.key,fieldOptions)(<div>\n        <Upload\n                action={url}\n                listType=\"picture-card\"\n                fileList={obj.state.fileList}\n                onChange={obj.onImageFileChange}\n                onRemove={obj.onRemove}\n                onPreview={obj.handlePreview}>\n          {obj.state.fileListSize ? \"\" : bpButton}\n        </Upload>\n        <Modal visible={obj.state.previewVisible} footer={null} onCancel={obj.handleCancel}>\n          <img alt=\"example\" style={{ width: '100%' }} src={obj.state.previewImage} />\n        </Modal>\n      </div>)}\n\n    ), field);\n  }\n\n}\n\nexport default ImageUpAndVIewConverter;\n"]}